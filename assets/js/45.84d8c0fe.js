(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{580:function(t,s,e){"use strict";e.r(s);var v=e(6),n=Object(v.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("ul",[e("li",[t._v("重排（Reflow）：当浏览器发现元素的几何属性（如位置、大小、布局等）发生变化时，需要重新计算元素在页面中的位置和大小，并更新整个页面的布局，这个过程称为重排，也叫回流。")]),t._v(" "),e("li",[t._v("重绘（Repaint）：当元素的外观发生变化，但不影响其在页面中的布局时，浏览器只需要重新绘制该元素，这个过程称为重绘。例如，改变元素的颜色、背景色、边框样式等，只会触发重绘。重排一定会触发重绘。")])]),t._v(" "),e("h2",{attrs:{id:"何时发生重排重绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#何时发生重排重绘"}},[t._v("#")]),t._v(" 何时发生重排重绘")]),t._v(" "),e("p",[t._v("改变页面元素的大小、位置、是否隐藏都会触发重排：")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("页面首次渲染。")])]),t._v(" "),e("li",[e("p",[t._v("浏览器窗口大小发生改变。")])]),t._v(" "),e("li",[e("p",[t._v("元素尺寸或位置发生改变元素内容变化（文字数量或图片大小等等）。")])]),t._v(" "),e("li",[e("p",[t._v("元素字体大小、字体样式变化。")])]),t._v(" "),e("li",[e("p",[t._v("添加或者删除可见的DOM元素。")])]),t._v(" "),e("li",[e("p",[t._v("激活CSS伪类（例如:hover）。")])]),t._v(" "),e("li",[e("p",[t._v("一些常用且会导致回流的属性和方法，因为这些都要去计算位置或大小：")]),t._v(" "),e("p",[t._v("原因：浏览器为了避免连续多次操作导致布局树的修改重复计算位置信息，会合并这些操作，因此改动属性造成的reflow是异步的，如果此时使用JS获取布局属性，浏览器会直接reflow以便获取到最新位置信息。")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("clientWidth")])]),t._v(" "),e("li",[e("code",[t._v("clientHeight")])]),t._v(" "),e("li",[e("code",[t._v("clientTop")])]),t._v(" "),e("li",[e("code",[t._v("clientLeft")])]),t._v(" "),e("li",[e("code",[t._v("offsetWidth")])]),t._v(" "),e("li",[e("code",[t._v("offsetHeight")])]),t._v(" "),e("li",[e("code",[t._v("offsetTop")])]),t._v(" "),e("li",[e("code",[t._v("offsetLeft")])]),t._v(" "),e("li",[e("code",[t._v("scrollWidth")])]),t._v(" "),e("li",[e("code",[t._v("scrollHeight")])]),t._v(" "),e("li",[e("code",[t._v("scrollTop")])]),t._v(" "),e("li",[e("code",[t._v("scrollLeft")])]),t._v(" "),e("li",[e("code",[t._v("scrollIntoView()")])]),t._v(" "),e("li",[e("code",[t._v("scrollIntoViewIfNeeded()")])]),t._v(" "),e("li",[e("code",[t._v("scrollTo()")])]),t._v(" "),e("li",[e("code",[t._v("getComputedStyle()")])]),t._v(" "),e("li",[e("code",[t._v("getBoundingClientRect()")])])])])]),t._v(" "),e("p",[t._v("改变外观、风格不影响布局，则触发重绘：")]),t._v(" "),e("ul",[e("li",[t._v("修改颜色"),e("code",[t._v("color")]),t._v("。")]),t._v(" "),e("li",[t._v("修改边框样式、背景颜色、背景图片。")]),t._v(" "),e("li",[t._v("文字对齐方式"),e("code",[t._v("text-decoration")]),t._v("。")]),t._v(" "),e("li",[e("code",[t._v("outline")]),t._v("（即使改变粗细也不会重排）。")])]),t._v(" "),e("h2",{attrs:{id:"减少回流和重绘"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#减少回流和重绘"}},[t._v("#")]),t._v(" 减少回流和重绘")]),t._v(" "),e("ul",[e("li",[e("p",[t._v("最小化重绘和重排")]),t._v(" "),e("p",[t._v("由于重绘和重排可能代价比较昂贵，因此最好就是可以减少它的发生次数。为了减少发生次数，我们可以合并多次对DOM和样式的修改，然后一次处理掉。")]),t._v(" "),e("div",{staticClass:"language-js line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("getElementById")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("padding "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'5px'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("borderLeft "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1px'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("borderRight "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'2px'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 大部分现代浏览器都对其做了优化，因此，只会触发一次重排。")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 使用cssText")]),t._v("\nel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("style"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cssText "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'border-left: 1px; border-right: 2px; padding: 5px;'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 修改CSS的class")]),t._v("\nel"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("className "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("' active'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[t._v("1")]),e("br"),e("span",{staticClass:"line-number"},[t._v("2")]),e("br"),e("span",{staticClass:"line-number"},[t._v("3")]),e("br"),e("span",{staticClass:"line-number"},[t._v("4")]),e("br"),e("span",{staticClass:"line-number"},[t._v("5")]),e("br"),e("span",{staticClass:"line-number"},[t._v("6")]),e("br"),e("span",{staticClass:"line-number"},[t._v("7")]),e("br"),e("span",{staticClass:"line-number"},[t._v("8")]),e("br"),e("span",{staticClass:"line-number"},[t._v("9")]),e("br"),e("span",{staticClass:"line-number"},[t._v("10")]),e("br")])])]),t._v(" "),e("li",[e("p",[t._v("批量修改DOM")]),t._v(" "),e("p",[t._v("当我们需要对DOM对一系列修改的时候，可以通过以下步骤减少回流重绘次数：")]),t._v(" "),e("ul",[e("li",[t._v("使元素脱离文档流 => 对其进行多次修改 => 将元素带回到文档中。")])]),t._v(" "),e("p",[t._v("该过程的第一步和第三步可能会引起回流，但是经过第一步之后，对DOM的所有修改都不会引起回流，因为它已经不在渲染树了。")]),t._v(" "),e("p",[t._v("有三种方式可以让DOM脱离文档流：")]),t._v(" "),e("ul",[e("li",[t._v("隐藏元素，应用修改，重新显示。")]),t._v(" "),e("li",[t._v("使用文档片段（document fragment，"),e("code",[t._v("document.createDocumentFragment")]),t._v("）在当前DOM之外构建一个子树，再把它拷贝回文档。")]),t._v(" "),e("li",[t._v("将原始元素拷贝到一个脱离文档的节点中，修改节点后，再替换原始的元素。")])])]),t._v(" "),e("li",[e("p",[t._v("避免触发同步布局事件")]),t._v(" "),e("p",[t._v("访问元素的一些属性的时候，会导致浏览器强制清空队列，进行强制同步布局。")])]),t._v(" "),e("li",[e("p",[t._v("对于复杂动画效果,使用绝对定位让其脱离文档流")]),t._v(" "),e("p",[t._v("对于复杂动画效果，由于会经常的引起回流重绘，因此，我们可以使用绝对定位，让它脱离文档流。否则会引起父元素以及后续元素频繁的回流。")])]),t._v(" "),e("li",[e("p",[t._v("css3硬件加速（GPU加速）")]),t._v(" "),e("ul",[e("li",[t._v("使用css3硬件加速，可以让"),e("code",[t._v("transform")]),t._v("、"),e("code",[t._v("opacity")]),t._v("、"),e("code",[t._v("filters")]),t._v("这些动画不会引起回流重绘。")]),t._v(" "),e("li",[t._v("对于动画的其它属性，比如"),e("code",[t._v("background-color")]),t._v("这些，还是会引起回流重绘的，不过它还是可以提升这些动画的性能。")])]),t._v(" "),e("p",[t._v("css3硬件加速的坑")]),t._v(" "),e("ul",[e("li",[t._v("如果你为太多元素使用css3硬件加速，会导致内存占用较大，会有性能问题。")]),t._v(" "),e("li",[t._v("在GPU渲染字体会导致抗锯齿无效。这是因为GPU和CPU的算法不同。可能CSS3的动画会产生字体模糊。")])]),t._v(" "),e("p",[t._v("常见的触发硬件加速的css属性（最好用"),e("code",[t._v("transform")]),t._v("，"),e("code",[t._v("animations")]),t._v("）：")]),t._v(" "),e("ul",[e("li",[e("code",[t._v("transform")])]),t._v(" "),e("li",[e("code",[t._v("animations")])]),t._v(" "),e("li",[e("code",[t._v("transition")])]),t._v(" "),e("li",[e("code",[t._v("opacity")])]),t._v(" "),e("li",[e("code",[t._v("filters")])]),t._v(" "),e("li",[e("code",[t._v("will-change")])])])])]),t._v(" "),e("p",[t._v("参考文章："),e("a",{attrs:{href:"https://github.com/chenjigeng/blog/issues/4",target:"_blank",rel:"nofollow noopener noreferrer"}},[t._v("你真的了解回流和重绘吗"),e("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);